@model GameIndexViewModel

@{
    ViewData["Title"] = "Jeux";
}
<h1>Liste des jeux</h1>

<form method="get" asp-action="Index" class="mb-3">
    <!-- Première ligne : Catégorie - Prix min - Prix max - Recherche -->
    <div class="row g-3">
        <div class="col-md-4">
            <label for="categoryId" class="form-label">Catégorie</label>
            <select id="categoryId" name="categoryId" class="form-select">
                <option value="">Toutes</option>
                @{ var selectedId = Model.SelectedCategory; }
                @foreach (var c in Model.Categories)
                {
                    <option value="@c.Id" selected="@(selectedId.HasValue && selectedId.Value == c.Id ? "selected" : null)">@c.Libelle</option>
                }
            </select>
        </div>

        <div class="col-md-2">
            <label for="minPrice" class="form-label">Prix min</label>
            <input type="number" step="1" min="0" id="minPrice" name="minPrice" class="form-control"
                   value="@(Model.MinPrice?.ToString() ?? string.Empty)" />
        </div>

        <div class="col-md-2">
            <label for="maxPrice" class="form-label">Prix max</label>
            <input type="number" step="1" min="0" max="@(Model.GlobalMaxPrice.HasValue ? Model.GlobalMaxPrice.Value.ToString("0") : string.Empty)" id="maxPrice" name="maxPrice"
                   class="form-control" value="@(Model.MaxPrice.HasValue ? Model.MaxPrice.Value.ToString("0") : string.Empty)" />
        </div>

        <div class="col-md-4">
            <label for="search" class="form-label">Rechercher par nom</label>
            <input type="text" id="search" name="search" class="form-control" value="@(Model.Search ?? string.Empty)"
                   placeholder="Nom du jeu..." />
        </div>
    </div>

    <!-- Deuxième ligne : switch à gauche, bouton à droite -->
    <div class="row align-items-center mt-2">
        <div class="col-auto">
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="onlyOwned" name="onlyOwned" value="true" @(Model.OnlyOwned ? "checked" : null) />
                <label class="form-check-label" for="onlyOwned">Jeux possédés</label>
            </div>
        </div>
        <div class="col text-end">
            <button type="submit" class="btn btn-primary">Filtrer</button>
        </div>
    </div>
</form>

<!-- Alerte si pas connecté -->
@if (Model.OnlyOwned && !Model.IsAuthenticated)
{
    <div class="alert alert-warning">Vous n'êtes pas connecté. Le filtre "Jeux possédés" ne sera pas appliqué et tous les jeux sont affichés.</div>
}

<table class="table">
    <thead>
    <tr>
        <th>Id</th>
        <th>Nom</th>
        <th>Description</th>
        <th>Prix</th>
        <th>Catégories</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var g in Model.Games)
    {
        <tr>
            <td>@g.Id</td>
            <td>@g.Name</td>
            <td>@g.Description</td>
            <td>@g.Price.ToString("C")</td>
            <td>@string.Join(", ", g.Categories.Select(c => c.Libelle))</td>
        </tr>
    }
    </tbody>
</table>